YUI.add("moodle-local_notificationsagent-form",function(u,i){function v(i){var t,e,a;document.querySelector('input[name="tab-target"]').value=i,t=document.querySelector("#ac-conditions .availability-inner"),e=document.querySelector("#ac-exceptions .availability-inner"),"nav-conditions-tab"==i?(a=0<!document.querySelector("#ac-conditions .availability-inner > .availability-children").children.length,document.getElementById("fitem_id_availabilityconditionsjson").setAttribute("aria-hidden",a),t.classList.remove("hide-div"),e.classList.add("hide-div")):"nav-exceptions-tab"==i?(a=0<!document.querySelector("#ac-exceptions .availability-inner > .availability-children").children.length,document.getElementById("fitem_id_availabilityconditionsjson").setAttribute("aria-hidden",a),e.classList.remove("hide-div"),t.classList.add("hide-div")):(t.classList.add("hide-div"),e.classList.add("hide-div"),document.getElementById("fitem_id_availabilityconditionsjson").setAttribute("aria-hidden",!0))}M.local_notificationsagent=M.local_notificationsagent||{},M.local_notificationsagent=u.Object(M.core_availability),M.core_availability.form.init=function(i){var t,e,r,a,l,n,s,o,d,c;for(t in i)e=i[t],(r=M[e[0]].form).init.apply(r,e);if(this.field=u.one("#id_availabilityconditionsjson"),this.field.setAttribute("aria-hidden","true"),this.mainDiv=u.Node.create('<div class="availability-field fcontainer"></div>'),this.field.insert(this.mainDiv,"after"),a=null,""!==(d=this.field.get("value")))try{a=u.JSON.parse(d)}catch(h){this.field.set("value","")}if(l={c:[],op:"&",showc:!0},n={c:[],op:"!|",showc:!0},null!==a)for(s=0;s<a.c.length;s++)o=a.c[s],a&&a.showc!==undefined&&(o.showc=a.showc[s]),0==s?l=o:1==s&&(n=o);this.rootList=new M.core_availability.List(null,!0),this.rootList.removeButton(),(d=new M.local_notificationsagent.List).constructorChildrenCustom(l,!1,this.rootList,"ac-conditions"),this.rootList.addChildCustom(d),(c=new M.local_notificationsagent.List).constructorChildrenCustom(n,!1,this.rootList,"ac-exceptions"),this.rootList.addChildCustom(c),(0<l.c.length||0<n.c.length)&&this.rootList.setVisibilityDiv(!1),this.mainDiv.appendChild(this.rootList.node),this.update(),this.rootList.renumber(),this.rootList.updateHtml(),d.selectAddCustom("newcondition"),c.selectAddCustom("newexception"),this.mainDiv.setAttribute("aria-live","polite"),this.field.ancestor("form").on("submit",function(){this.mainDiv.all("input,textarea,select").set("disabled",!0)},this),this.restrictByGroup=u.one("#restrictbygroup"),this.restrictByGroup&&(this.restrictByGroup.on("click",this.addRestrictByGroup,this),d=u.one("#id_groupmode"),c=u.one("#id_groupingid"),d&&d.on("change",this.updateRestrictByGroup,this),c&&c.on("change",this.updateRestrictByGroup,this),this.updateRestrictByGroup()),v(document.querySelector("#nav-tab a.active").id)},M.local_notificationsagent.List.prototype.constructorChildrenCustom=function(i,t,e,a){var l,n;if(this.children=[],t!==undefined&&(this.root=t),this.node=u.Node.create('<div id="'+a+'" class="availability-list"><h3 class="accesshide"></h3><div class="availability-inner hide-div"><div class="availability-header mb-1"><span>'+M.util.get_string("listheader_sign_before","availability")+'</span> <label><span class="accesshide">'+M.util.get_string("label_sign","availability")+' </span><select class="availability-neg custom-select mx-1" title="'+M.util.get_string("label_sign","availability")+'"><option value="">'+M.util.get_string("listheader_sign_pos","availability")+'</option><option value="!">'+M.util.get_string("listheader_sign_neg","availability")+'</option></select></label> <span class="availability-single">'+M.util.get_string("listheader_single","availability")+'</span><span class="availability-multi">'+M.util.get_string("listheader_multi_before","availability")+' <label><span class="accesshide">'+M.util.get_string("label_multi","availability")+' </span><select class="availability-op custom-select mx-1" title="'+M.util.get_string("label_multi","availability")+'"><option value="&">'+M.util.get_string("listheader_multi_and","availability")+'</option><option value="|">'+M.util.get_string("listheader_multi_or","availability")+"</option></select></label> "+M.util.get_string("listheader_multi_after","availability")+'</span></div><div class="availability-children"></div><div class="availability-none"><span class="px-3">'+M.util.get_string("none","moodle")+'</span></div><div class="clearfix mt-1"></div></div><div class="clearfix"></div></div>'),t||this.node.addClass("availability-childlist d-sm-flex align-items-center"),this.inner=this.node.one("> .availability-inner"),a=!1,e&&(i&&i.showc!==undefined&&(a=i.showc),this.eyeIcon=new M.core_availability.EyeIcon(!1,a),this.inner.insert(this.eyeIcon.span,"before")),i){switch(i.op){case"&":case"|":this.node.one(".availability-neg").set("value","");break;case"!&":case"!|":this.node.one(".availability-neg").set("value","!")}switch(i.op){case"&":case"!&":this.node.one(".availability-op").set("value","&");break;case"|":case"!|":this.node.one(".availability-op").set("value","|")}for(l=0;l<i.c.length;l++)n=i.c[l],this.root&&i&&i.showc!==undefined&&(n.showc=i.showc[l]),n=n.type!==undefined?new M.core_availability.Item(n,this.root):new M.core_availability.List(n,!1,this.root),this.addChildCustom(n)}this.updateHtml()},M.local_notificationsagent.List.prototype.addChildCustom=function(i){this.children.push(i),this.inner.one(".availability-children").appendChild(i.node)},M.core_availability.List.prototype.removeButton=function(i){this.node.one("div.availability-button").remove()},M.core_availability.List.prototype.setVisibilityDiv=function(i){u.one("#fitem_id_availabilityconditionsjson").setAttribute("aria-hidden",i)},M.local_notificationsagent.List.prototype.selectAddCustom=function(i){var t,e,a,l=u.one("#id_"+i+"_select"),n=u.one("#fgroup_id_"+i+"_group"),s=u.Node.create('<div class="hide-div"></div>');for(e in M.core_availability.form.plugins
)M.core_availability.form.plugins[e].allowAdd&&(a=u.Node.create('<option data-type="ac" value="'+(t=i+"_availability_addrestriction_"+e)+'" class="availability-field fcontainer">'+M.util.get_string("title","availability_"+e)+"</option>"),l.appendChild(a),(a=u.Node.create('<button type="button" class="btn btn-secondary w-100"id="'+t+'">'+M.util.get_string("title","availability_"+e)+"</button>")).on("click",this.getAddHandlerCustom(e),this),s.appendChild(a));n.appendChild(s)},M.local_notificationsagent.List.prototype.getAddHandlerCustom=function(t){return function(){var i=t?new M.core_availability.Item({type:t,creating:!0},this.root):new M.core_availability.List({c:[],showc:!0},!1,this.root);this.addChildCustom(i),M.core_availability.form.update(),M.core_availability.form.rootList.renumber(),this.updateHtml(),i.focusAfterAdd(),M.core_availability.form.rootList.setVisibilityDiv(!1)}},M.local_notificationsagent.List.prototype.deleteDescendant=function(i){for(var t,e,a=0;a<this.children.length;a++){if((t=this.children[a])===i)return this.children.splice(a,1),e=t.node,this.inner.one("> .availability-children").removeChild(e),M.core_availability.form.update(),this.updateHtml(),0<!this.children.length&&this.setVisibilityDiv(!0),!0;if(t instanceof M.core_availability.List&&t.deleteDescendant(i))return!0}return!1},document.querySelectorAll('a[data-toggle="tab"]').forEach(function(i){i.addEventListener("click",function(i){v(i.target.id)})})},"@VERSION@",{requires:["base","node","event","moodle-core_availability-form"]});